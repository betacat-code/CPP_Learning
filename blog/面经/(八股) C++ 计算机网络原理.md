# TCP UDP 

## 原理

TCP 是一种面向连接的协议，提供可靠的数据传输机制。它通过三次握手建立连接，使用序列号和确认应答来保证数据的有序性、完整性和可靠性。使用滑动窗口协议来控制流量，以及拥塞控制机制来调整传输速率，保证网络的稳定性。使用字节流传输，应用程序无需关心数据的分段和组装，TCP 层会负责数据的划分和重组。

UDP 是一种无连接的协议，提供了简单的数据传输服务，但不保证数据的可靠性和顺序性。UDP将数据打包成数据报，直接发送到目标地址，不需要建立连接。因此，UDP 的传输速度相对较快，并且消耗较少的资源。UDP 不提供流量控制和拥塞控制，数据报可能会丢失、重复或乱序，应用程序需要自行处理这些情况。

## 区别

**连接性：**
- TCP 是面向连接的，需要先建立连接后才能传输数据，且在数据传输结束后需要断开连接。
- UDP 是无连接的，发送数据时不需要建立连接，也不需要断开连接，每个数据报都是独立的。

**可靠性：**

- TCP 提供可靠的数据传输服务，保证数据的有序性、完整性和可靠性，通过重传机制等方式来确保数据的正确传输。
- UDP 不保证数据的可靠性，数据报可能丢失、重复或乱序，应用程序需要自行处理数据传输中的错误和丢失。

**速度和效率：**

- TCP 的传输速度相对较慢，它需要进行连接的建立和断开，以及流量控制和拥塞控制等额外的机制。
- UDP 的传输速度相对较快，它是无连接的，没有额外的连接建立和拆除过程，并且不进行流量控制和拥塞控制。

## 应用场景

**TCP 的应用场景：**

- 需要可靠传输、有序传输的场景，如文件传输、网页浏览、电子邮件等。
- 对数据完整性要求较高的应用，如传输金融数据、在线支付等。
- 需要长时间持续连接的应用，如远程登录、文件同步等。

**UDP 的应用场景：**

- 实时性要求高、对数据丢失或延迟不敏感的应用，如实时音视频传输、在线游戏等。
- 对传输速度和效率要求较高，且能够容忍数据丢失或重复的应用，如实时监控、广播等。
- DNS 查询、NTP 时间同步等对传输速度要求较高，但对数据可靠性要求较低的应用。

# 为什么握手是三次而挥手需要四次

握手过程是为了确保通信双方都准备好了开始传输数据。TCP 的三次握手过程如下：

- 客户端发送一个带有 SYN（同步序列编号）标志的数据包给服务器，并进入 SYN_SENT 状态。
- 服务器收到 SYN 数据包后，会回复一个带有 SYN/ACK 标志的数据包以示确认，并进入 SYN_RCVD 状态。
- 客户端收到服务器的确认后，会再次发送一个带有 ACK 标志的数据包给服务器，表示握手成功，双方可以开始通信，客户端和服务器都进入 ESTABLISHED 状态。

挥手过程是为了关闭连接并释放资源。TCP 的四次挥手过程如下：

- 客户端发送一个带有 FIN（结束）标志的数据包给服务器，表示客户端不再发送数据，进入 FIN_WAIT_1 状态。
- 服务器收到 FIN 数据包后，会发送一个带有 ACK 标志的数据包给客户端，表示收到了关闭请求，并进入 CLOSE_WAIT 状态。
- 服务器完成了发送数据后，会发送一个带有 FIN 标志的数据包给客户端，表示自己也准备关闭连接，进入 LAST_ACK 状态。
- 客户端收到服务器的关闭请求后，会发送一个带有 ACK 标志的数据包给服务器，表示确认收到关闭请求，客户端进入 TIME_WAIT 状态。在这个状态下，客户端等待一段时间（等待 2 倍的最大报文段寿命），确保服务器接收到了确认，然后再关闭连接。服务器在收到客户端的确认后，会进入 CLOSED 状态。


TCP建立连接时之所以只需要"三次握手"，是因为在第二次"握手"过程中，服务器端发送给客户端的TCP报文是以SYN与ACK作为标志位的。SYN是请求连接标志，表示服务器端同意建立连接；ACK是确认报文，表示告诉客户端，服务器端收到了它的请求报文。

即SYN建立连接报文与ACK确认接收报文是在同一次"握手"当中传输的，所以"三次握手"不多也不少，正好让双方明确彼此信息互通。

TCP释放连接时之所以需要“四次挥手”,是因为FIN释放连接报文与ACK确认接收报文是分别由第二次和第三次"握手"传输的。建立连接时，被动方服务器端结束CLOSED阶段进入“握手”阶段并不需要任何准备，可以直接返回SYN和ACK报文，开始建立连接。释放连接时，被动方服务器，突然收到主动方客户端释放连接的请求时并不能立即释放连接，因为还有必要的数据需要处理，所以服务器先返回ACK确认收到报文，经过CLOSE-WAIT阶段准备好释放连接之后，才能返回FIN释放连接报文。


# TCP慢启动，拥塞控制实现

慢启动阶段：当 TCP 连接建立后，发送方会将拥塞窗口（cwnd）初始化为一个较小的值，通常为 1 个报文段的大小。发送方发送数据时，每收到一个 ACK 确认，拥塞窗口大小就会加倍，即指数增长。在慢启动阶段中，发送方不断增大拥塞窗口，直到达到一个阈值（慢启动阈值）。一旦达到慢启动阈值，就会进入拥塞避免阶段。

拥塞避免阶段：每经过一个RTT，拥塞窗口增加一个 MSS（最大报文段长度）。

超时重传：如果发生丢包（即超时未收到 ACK 确认），TCP 将识别这个事件为网络拥塞的标志，并将拥塞窗口减小一半（拥塞避免阶段的慢启动阈值也被设为当前窗口大小的一半）。把拥塞窗口设置为1，重新开始慢启动阶段。

快恢复：发送端收到连续三个冗余ACK(即重复确认)时，执行乘法减小算法，把慢启动阈值设置为出现拥塞时发送方拥塞窗口的一半。开始执行拥塞避免算法(加法增大)，使拥塞窗口缓慢地线性增大。

# HTTP
HTTP是一种用于传输超文本数据的应用层协议，规定了客户端和服务器之间进行通信的格式和规则。

在OSI（开放式系统互联）模型中，HTTP协议位于应用层。从物理层到应用层分别是：物理层、数据链路层、网络层、传输层、会话层、表示层和应用层

# http2和http1的区别

新的二进制格式：HTTP2采用二进制格式而HTTP1使用文本格式。

多路复用：HTTP2是完全多复用的，而非有序并阻塞的，只需一个连接即可实现并行。HTTP1一个连接只能发送一个请求。

首部压缩：HTTP1.x的header带有大量信息，而且每次都要重复发送，HTTP2.0使用encoder来减少需要传输的header大小，通讯双方各自cache一份header fields表，既避免了重复header的传输，又减小了需要传输的大小。

服务器推送：HTTP2在客户端请求资源的时候，会把相关的资源一起发送给客户端，而不需要客户端再次发起请求获取资源。

请求优先级：HTTP2 支持请求优先级，客户端可以告知服务器请求的优先级，服务器可以根据这些信息来优化资源传输顺序，提高页面加载性能。

# HTTPS用到的是对称加密还是非对称加密？

HTTPS 通信实际上同时使用了对称加密和非对称加密。

在 HTTPS 通信中，非对称加密主要用于在建立连接时进行密钥交换和身份验证。HTTPS 通信开始时，服务器会向客户端发送其公钥，客户端使用该公钥加密一个随机生成的对称密钥，并将其发送回服务器。服务器使用自己的私钥解密客户端发送的数据，获取对称密钥，然后双方都使用该对称密钥进行后续的对称加密通信。对称加密用于加密实际的数据传输，这包括 HTTP 请求和响应的内容。

综上所述，HTTPS 中的对称加密用于加密实际的数据传输，而非对称加密用于安全地进行密钥交换和身份验证。

# tcp/ip模型

应用层：提供网络服务和应用程序之间的接口。
传输层：负责在网络的两个节点之间提供数据传输（TCP UDP）。
网络层：负责在网络之间提供数据包的传输和路由。
数据链路层：负责在物理网络上的节点之间提供数据的传输和链路管理。

# get和post区别

使用 GET 请求时，请求的参数会附加在 URL 的末尾，以 ? 开头，参数之间使用 & 分隔。GET 请求的参数会暴露在 URL 中，因此不适合传输敏感信息，如密码等。且对数据长度有限制，通常在 2KB 到 8KB 之间。

使用 POST 请求时，请求的参数以键值对的形式放在请求的消息体中传输，没有数据长度限制，适合用于传输大量数据或敏感信息。

# ping命令

ping 命令用的是 ICMP（Internet Control Message Protocol）协议。ICMP 是网络层（第三层）的协议。使用了ICMP回送请求和回答报文。


# 有限状态机怎么解析http报文


1.初始状态为等待请求行。

2.读取请求行中的方法、URL和协议版本信息。

3.根据请求行中的方法判断是否需要读取请求头部（例如POST方法需要读取Content-Length头部），如果需要则转移到等待请求头部状态，否则直接跳到等待消息体状态。

4.在等待请求头部状态下，循环读取每个请求头部，并解析出对应的键值对。

5.如果已经读取完所有请求头部，则转移到等待消息体状态；否则继续等待下一个请求头部。

6.在等待消息体状态下，根据头部指定的长度或编码方式读取消息体内容，并将其存储在缓冲区中。

7.当全部消息体内容都被读取完毕后，解析器进入完成处理状态并返回结果给调用者。



# 路由表

标准的路由表有4个项目：目的网络IP地址、子网掩码、下一跳IP地址、接口。



## 路由表为空怎么找到下一跳

默认路由：默认路由是一种特殊的路由项，它指示当路由表中找不到匹配的路由时应采取的动作。默认路由一般配置为一个默认的下一跳地址，用于处理所有无法匹配的目标地址。

ARP（地址解析协议）：如果路由表为空，但主机或路由器知道目标地址位于本地网络上，则可以使用ARP协议来查找目标地址的MAC地址。

静态路由配置：手动配置静态路由来指定下一跳。静态路由是管理员手动配置的路由项，它们不会随网络拓扑的变化而改变，可以用于指定特定目标地址的下一跳。

动态路由协议：动态路由协议能够自动发现网络拓扑并更新路由表，从而确定下一跳地址。

# TCP 粘包拆包

TCP将应用层数据拆分成多个小数据块（称为报文段），每个报文段都会添加一个TCP头，用于控制报文的传输。由于网络的不可靠性，TCP为了提高传输效率，会将多个小数据块打包成一个大的数据块一起发送（称为TCP粘包），或者将一个大的数据块拆分成多个小的数据块发送（称为TCP拆包）。这种情况可能发生在发送和接收数据的任何一端，通常是由于TCP缓冲区的大小限制或数据发送和接收的速率不一致引起的。

## 解决方法

消息定长：要求所有的数据包都是固定长度的，这样在接收方就可以按照固定长度来进行接收，不会出现粘包和拆包问题。如果发送的数据长度不足固定长度，则在后面填充空格或者其他特定字符，如果超过固定长度，则进行截断处理。

消息分隔符：在每个数据包的结尾加上一个特定的分隔符，接收方可以根据分隔符来判断每个数据包的结束位置。

消息长度头：在每个数据包的头部添加一个长度字段，用于表示数据包的长度，接收方可以根据长度字段来判断每个数据包的结束位置。

# TCP 建立连接过程中 SYN + ACK 包能不能拆开来发？

三次握手的标准过程：

- 客户端发送一个SYN包到服务器，以开始新的连接。
- 服务器响应客户端的SYN包，发送一个包含SYN和ACK标志的包，这个包既是对客户端SYN包的确认（ACK），也是服务器开始连接的请求（SYN）。
- 客户端接收到服务器的SYN+ACK包后，发送一个ACK包作为响应，完成握手过程。

理论上：SYN和ACK在技术上是可以分开发送的，即先发送一个只有SYN标志的包，再发送一个只有ACK标志的包。然而，这种行为并不符合TCP的标准三次握手协议，也会增加握手所需的时间和资源消耗，降低效率。

实际应用中：在TCP的三次握手过程中，服务器总是将SYN和ACK标志一起发送给客户端（在第二步中），这样做是为了确认客户端的SYN请求的同时，也通知客户端服务器准备好了开始新的连接。这种做法可以减少消息的往返次数和建立连接所需要的时间。